# GitHub Copilot コードレビュー設定

## レビュー言語設定

- **すべてのレビューコメントは日本語で記述してください**
- 技術用語は適切に日本語化するか、必要に応じて英語併記してください
- コード例は英語のまま記載して構いません
- 絵文字を使用したコミットメッセージ形式を理解し、適切に評価してください

## レビューフォーカスエリア

### 1. コード品質（Tidy First 原則）

- **Kent Beck の「Tidy First?」に基づくレビュー**
  - Tidying（整理）と Behavior Change（振る舞いの変更）の分離
  - Guard Clauses（早期リターン）の適用
  - Dead Code Removal（不要コードの削除）
  - 対称性の統一と可読性の向上
- 小さく安全な変更を推奨
- 漸進的改善を重視

### 2. TypeScript 固有の確認事項

- **命名規則の遵守**
  - PascalCase: クラス、インターフェース、型エイリアス、enum
  - camelCase: 変数、関数、メソッド、パラメータ
  - UPPER_SNAKE_CASE: 定数、環境変数
  - boolean 型は`is`, `has`, `should`, `can`プレフィックス
  - 配列・コレクションは複数形
- **型安全性の確保**
  - any 型の使用を避ける
  - 適切な型定義とインターフェースの使用
  - インターフェース名に`I`プレフィックスは不要

### 3. プロジェクト規約の遵守

- Figma API 呼び出し関数の命名規則（`〜Api`サフィックス）
- レスポンス型名と関数名の一貫性
- テストファイルの命名規則

### 4. マジックナンバー・マジックストリングの検出

- **高優先度（必ず定数化）**
  - ビジネスロジックの数値
  - 環境依存の値
  - 複数箇所で使用される値
- **中優先度（定数化推奨）**
  - 意味が不明瞭な値
  - デバッグ時に調整する可能性のある値
- **許容される例外**
  - 0, 1, -1（自明な場合）
  - 単位変換（例: `ms / 1000`）
  - 標準的な値（HTTP ステータスコード等）

### 5. コメントの最適化

- **許可するコメントは 3 種のみ**
  1. 意図コメント（Why）: なぜこの実装を選択したか
  2. Doc コメント: 公開 API/外部境界の仕様（JSDoc/TSdoc）
  3. ファイルコメント: ファイル全体の意図/前提（1-5 行）
- **削除対象**
  - What/How の説明（コードの逐語説明）
  - コメントアウトされたコード
  - 根拠なき TODO/FIXME
  - 陳腐化したコメント

### 6. テストコードの品質

- **FIRST 原則の遵守**
  - Fast（高速）、Independent（独立）、Repeatable（再現可能）
  - Self-Validating（自己検証）、Timely（適時）
- **AAA パターンの適用**
  - Arrange（準備）、Act（実行）、Assert（検証）の明確な分離
- **テスト名の明確化**
  - 「何を」「どういう条件で」「どうなるか」を表現
- **モックの適切な使用**
  - 必要最小限のモック化
  - 外部依存の適切な分離
- **テストファイルの適切な分割**
  - 単一の巨大なテストファイルを避ける
  - 機能やコンポーネント単位でテストファイルを分割
  - エンドポイント毎にテストファイルを作成（例: `get-components.test.ts`, `get-component-sets.test.ts`）
  - 各テストファイルは単一の責務を持つ

### 7. パフォーマンス

- **測定ファーストの最適化**
  - 推測ではなく実測に基づく最適化を推奨
  - Core Web Vitals を重視
- **React 最適化**
  - 不要な re-render の防止
  - React.memo、useMemo、useCallback の適切な使用
  - バンドルサイズの最適化
  - Code splitting の実装
- **バックエンド最適化**
  - N+1 クエリ問題の検出
  - 適切なキャッシュ戦略
  - 非同期処理の活用
  - メモリリークの防止
- **API 最適化**
  - ペイロードサイズの最小化
  - 圧縮の適用
  - ページネーションの実装

### 8. セキュリティ

- 機密情報の露出防止
- 適切なエラーハンドリング
- 入力値の検証

## レビュー時の重要度レベル

### 🔴 Critical（必須修正）

- セキュリティ上の脆弱性
- データ損失のリスク
- アプリケーションのクラッシュを引き起こす可能性

### 🟡 Important（修正推奨）

- パフォーマンスの大幅な低下
- 保守性を著しく損なうコード
- プロジェクト規約からの重大な逸脱

### 🟢 Suggestion（改善提案）

- コードの可読性向上
- より良い実装パターンの提案
- 軽微な最適化

## プロジェクト固有のルール

### 1. 開発手法

- **TDD（テスト駆動開発）の遵守**
  - Red → Green → Refactor のサイクルを守っているか確認
  - テストが先に書かれているか評価
  - テストカバレッジの適切性を確認

### 2. API 関数の命名

- API パスの構造を反映した命名を使用
- 例: `/v1/files/{fileKey}/components` → `fileComponentsApi`
- API エンドポイント関数は `〜Api` サフィックスを使用

### 3. 型定義

- レスポンス型は関数名に対応させる
- 例: `fileComponentsApi` → `FileComponentsApiResponse`
- any 型の使用を避け、適切な型定義を使用

### 4. テスト構造

- テストファイル名は実装ファイル名に対応
- 例: `file-components-api.ts` → `file-components-api.test.ts`
- フラットなテスト構造を推奨（過度なネストを避ける）
- **テストファイルの分割を必須とする**
  - 各エンドポイント/機能ごとに独立したテストファイル
  - 統合テストファイルの巨大化を防ぐ

## レビューコメントのフォーマット

```
【重要度】🔴/🟡/🟢
【カテゴリ】品質/パフォーマンス/セキュリティ/規約/その他
【問題点】具体的な問題の説明
【提案】改善案や修正方法
【コード例】（必要に応じて）
```

## 除外事項

以下の項目についてはレビュー対象外とする：

- 自動生成されたファイル（dist/, node_modules/など）
- 設定ファイルの軽微な変更
- ドキュメントのタイポ修正のみの PR

## フィードバック歓迎事項

- より良い実装パターンの提案
- パフォーマンス改善のアイデア
- 可読性向上のための代替案
- 新しい TypeScript 機能の活用提案
